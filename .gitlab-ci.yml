# Using the official Python Docker image as default
image: "python"

before_script:
  - python --version
  - uname -a
  - apt-get update
  - apt-get install -y libldap2-dev libsasl2-dev
  - "[ -r requirements.txt ] && pip install -r requirements.txt"
  - pip install tox

stages:
  - Test
  - Publish

unit_test:
  stage: Test
  script:
    - tox
  artifacts:
    paths:
      - htmlcov/

unit_test:3.8:
  image: "python:3.8"
  stage: Test
  script:
    - tox

unit_test:3.7:
  image: "python:3.7"
  stage: Test
  script:
    - tox

pages:
  stage: Publish
  dependencies:
    - unit_test
  script:
    - mkdir -p public
    - mv htmlcov public/
  artifacts:
    paths:
      - public/htmlcov
    expire_in: 30 days
  only:
    - master

